# Мультимодальная RAG система

## Обзор проекта

Данный проект представляет собой систему для мультимодального поиска и генерации ответов (Retrieval-Augmented Generation, RAG), которая использует как текстовую, так и визуальную информацию для эффективного анализа и ответа на запросы пользователей. Система способна извлекать релевантные изображения и генерировать текстовые ответы с учетом визуального и текстового контекста.

## Основная гипотеза проекта

Наша главная гипотеза заключается в том, что комбинирование текстовых и визуальных эмбеддингов значительно улучшает точность и качество мультимодального поиска. Интеграция данных из разных типов источников (текстовых описаний и изображений) обеспечивает более глубокое понимание контекста и повышает релевантность результатов.

## Архитектура проекта

### Структура репозитория
multimodal-rag/
├── app.py                  # Основной файл приложения для запуска сервиса
├── run_app.sh              # Скрипт для быстрого запуска приложения
├── requirements.txt        # Список зависимостей проекта
├── pyproject.toml          # Конфигурация Python-проекта
├── setup.cfg               # Конфигурация для установки проекта

├── data/                   # Директория с данными для индексирования и поиска

├── src/                    # Исходный код проекта
│   ├── __init__.py
│   ├── config/             # Конфигурационные файлы
│   │   ├── bge_config.yaml         # Конфигурация для текстовой модели
│   │   └── colqwen_config.yaml     # Конфигурация для визуальной модели
│   ├── llm/                # Модули для работы с языковой моделью
│   │   ├── __init__.py
│   │   ├── chat.py                 # API для генерации ответов через LLM
│   │   └── prompt.yaml             # Шаблоны промптов
│   ├── retrievers/         # Модули для извлечения релевантной информации
│   │   ├── __init__.py
│   │   ├── base.py                 # Базовые классы для ретриверов
│   │   ├── build_bge_index.py      # Создание текстовых индексов
│   │   ├── build_colqwen_meta.py   # Создание визуальных индексов
│   │   └── retrieve.py             # Основной модуль поисковой системы
│   └── utils.py            # Вспомогательные функции и утилиты



## Ключевые компоненты системы

### 1. Индексирование и поиск данных

#### Текстовый поиск (BGE)
- Использует модель для создания эмбеддингов текстовых описаний
- Индексирует текстовые эмбеддинги с использованием FAISS для эффективного поиска
- Позволяет находить релевантные изображения на основе их текстовых описаний

#### Визуальный поиск (ColQwen)
- Использует модель Vision Transformer (ViT) для создания визуальных эмбеддингов изображений
- Индексирует визуальные характеристики изображений для последующего поиска
- Позволяет находить визуально похожие изображения на основе запросов пользователя

### 2. Мультимодальные стратегии поиска

#### SummaryEmb
Эта стратегия извлекает изображения с использованием текстовых эмбеддингов, полученных из описаний изображений (summary) через Pixtral-12b. Помогает учитывать текстовый контекст изображений, но напрямую не использует визуальную информацию.

#### ColQwen
Визуальные эмбеддинги, полученные через модель ViT, используются для извлечения изображений, релевантных запросу. Эта стратегия позволяет учитывать исключительно визуальные характеристики изображений.

#### ColQwen+SummaryEmb
Данная стратегия объединяет лучшие результаты текстовых и визуальных эмбеддингов, выбирая наиболее релевантные изображения из обоих подходов. Помогает эффективно решать задачи, требующие мультимодального анализа.

### 3. Генерация ответов через языковую модель

- Интеграция с Pixtral-12b для генерации качественных текстовых ответов
- Модуль формирования эффективных промптов на основе найденных изображений и запроса пользователя
- Обработка как текстовой, так и визуальной информации для создания содержательных ответов

## Web-интерфейс

Проект включает пользовательский интерфейс на базе Streamlit, который предоставляет:
- Возможность ввода пользовательских запросов
- Выбор стратегий поиска
- Отображение найденных релевантных изображений
- Отображение сгенерированных ответов
- Сохранение истории чата

## Требования и запуск

### Требования
- Python 3.11.6 или выше (согласно pyproject.toml)
- Poppler (для работы с PDF-документами)
- CUDA-совместимый GPU (рекомендуется для оптимальной производительности)
- colpali-engine
- PyTorch
- Streamlit (≥1.41.1)
- FAISS (faiss-cpu ≥1.9.0.post1)
- Transformers
- mistralai (≥1.3.1)
- python-dotenv (≥1.0.1)
- Pillow
- NumPy
- SciPy
- tqdm
- omegaconf (≥2.3.0)
- pdf2image (≥1.17.0)
- pyyaml (≥6.0.2)

### Запуск приложения

```bash
streamlit run app.py
```
или используйте скрипт:
```bash
./run_app.sh
```

Откройте веб-браузер и перейдите по адресу `http://localhost:8501`.

## Время сборки и запуска

1. **Установка зависимостей:**  
   Занимает около **2-3 минут**.

2. **Запуск приложения:**  
   После установки зависимостей запуск происходит мгновенно.
